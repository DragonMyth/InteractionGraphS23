run: DDPPO
name: exp107_1
local_dir: /checkpoint/jungdam/Research/ScaDive/data/learning/multiagent/boxing/
checkpoint_freq: 200
checkpoint_at_end: true
reuse_actors: true
stop: 
    time_total_s: 7200000
config:
    env: HumanoidBoxing
    log_level: WARN
    gamma: 0.99
    lambda: 0.95
    clip_param: 0.2
    kl_coeff: 0.0
    vf_clip_param: 5000
    num_sgd_iter: 20
    lr: 0.00002
    sgd_minibatch_size: 2000
    horizon: 1800
    train_batch_size: 100000
    rollout_fragment_length: 50
    normalize_actions: false
    clip_actions: true
    num_envs_per_worker: 5
    num_cpus_per_worker: 5
    num_gpus_per_worker: 0
    remote_worker_envs: true
    shuffle_sequences: false
    framework: torch
    model:
        custom_model: task_agnostic_policy_type1
        custom_model_config:
            log_std_type: constant
            sample_std: 0.05
            task_encoder_type: "mlp"
            task_encoder_inputs:
                - body
                - task
            task_encoder_output_dim: 32
            # task_encoder_layers:
            #     - type: lstm
            #       hidden_size: 128
            #       num_layers: 2
            #       output_activation: "linear"
            motor_decoder_layers:
                - type: fc
                  hidden_size: 256
                  activation: "relu"
                  init_weight:
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: 128
                  activation: "relu"
                  init_weight:
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: output
                  activation: "linear"
                  init_weight:
                      name: normc
                      std: 0.01
            
            task_decoder_enable: false
            body_encoder_enable: false
            
            motor_decoder_type: "mlp"
            motor_decoder_inputs:
                - body
                - task
            motor_decoder_task_bypass: false
            motor_decoder_layers:
                - type: fc
                  hidden_size: 512
                  activation: "relu"
                  init_weight:
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: 512
                  activation: "relu"
                  init_weight:
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: 512
                  activation: "relu"
                  init_weight:
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: output
                  activation: "linear"
                  init_weight:
                      name: normc
                      std: 0.01
            motor_decoder_load_weights: "data/etc/pretrained_model/boxing/TrainModel_2021-12-29_14-35-08/TrainModel_939d6_00010_10_FP_cyc_coeff=0.01,FP_depth=2,FP_width=1024,MD_depth=3,MD_type=mlp,MD_width=512,TE_cond=abs,a_rec_coeff=1_2021-12-29_14-37-22/checkpoint_000600/motor_decoder.pt"
            motor_decoder_learnable: false

            motor_decoder_helper_enable: true
            motor_decoder_helper_range: 1.0
            
            # training_schedule:
            #     method: e2e
            #     decoder_learn_start: 800
            #     decoder_learn_lengh: 20
            #     encoder_learn_lengh: 80
    num_workers: 8
    num_gpus: 0
    batch_mode: truncate_episodes
    observation_filter: NoFilter
    multiagent: None
    env_config:
        ac_scale: 3.0
        share_policy: true
        lazy_creation: false
        project_dir: /private/home/jungdam/Research/ScaDive/
        fps_sim: 480
        fps_con: 30
        self_collision: true
        add_noise: false
        verbose: false
        ground:
            enable: true
            falldown_check:
                method: height
                height_min: 0.3
            size: 
                - 5.0 # width1
                - 5.0 # width2
                - 5.0 # heigh, only used for checking out-of-ground
        state:
            choices: ['body', 'game_basic', 'contact_state']
            body_type: facing_R6_h
        action:
            # 'absolute', 'relative'
            type: "absolute"
            range_min: -3.0
            range_max: 3.0
            range_min_pol: -3.0
            range_max_pol: 3.0
        reward: 
            fn_def:
                default:
                    name: default
                    op: add
                    child_nodes:
                      - name: boxing
                        op: add
                        weight: 1.0
                        child_nodes:
                          # - name: upright_upper_body
                          #   op: leaf
                          #   weight: -0.1
                          #   kernel: 
                          #       type: none
                          # - name: energy_consumption_by_distance
                          #   op: leaf
                          #   weight: -0.0001
                          #   kernel: 
                          #       type: none
                          - name: dist_to_targets
                            op: leaf
                            weight: 0.2
                            kernel: 
                                type: gaussian
                                scale: 3.0
                          - name: facing_dir_alignment
                            op: leaf
                            weight: 0.05
                            kernel: 
                                type: gaussian
                                scale: 5.0
                          # - name: out_of_arena
                          #   op: leaf
                          #   weight: -30.0
                          #   kernel: 
                          #       type: none
                          - name: falldown
                            op: leaf
                            weight: -50.0
                            kernel: 
                                type: none
                          # - name: too_close_pos
                          #   op: leaf
                          #   weight: -30.0
                          #   kernel: 
                          #       type: none
                          - name: take_score
                            op: leaf
                            weight: 2.0
                            kernel: 
                                type: none
                          - name: lose_score
                            op: leaf
                            weight: -2.0
                            kernel: 
                                type: none
            fn_map:
                - default
                - default
        early_term:
            choices:
                - timeover
                - gameover
                - falldown
                - too_close_pos
            eoe_margin: 0.0
        character:
            name:
                - player1
                - player2
            char_info_module:
                - humanoid_boxing_char_info2.py
                - humanoid_boxing_char_info2.py
            sim_char_file:
                - data/character/humanoid_boxing.urdf
                - data/character/humanoid_boxing.urdf
            ref_motion_scale:
                - 1.0
                - 1.0
            base_motion_file:
                - data/motion/multiagent/boxing/player1.bvh
                - data/motion/multiagent/boxing/player2.bvh
            ref_motion_db:
                - data:
                    file:
                            - data/motion/multiagent/boxing/player1.bvh
                - data:
                    file:
                            - data/motion/multiagent/boxing/player1.bvh
            physics:
                -
                    actuation: spd
                    self_collision: true
                -
                    actuation: spd
                    self_collision: true
            environment_file:
                - data/character/boxing_ropes_small.urdf
        game:
            arena_width: 4.7
            arena_outer_margin: 1.05
            min_touch_force: 1.0
            type: total_score
            init_score: 9999.0
            duration: 60.0
            touch_interval: 0.5
            max_force_clip: 200.0
            target_links:
                lowerneck: 2.0
                upperneck: 2.0
                lowerback: 0.5
                upperback: 0.5
                chest: 0.5
                lclavicle: 0.2
                rclavicle: 0.2