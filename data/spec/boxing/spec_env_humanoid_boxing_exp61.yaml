run: DDPPO
name: exp61
local_dir: /checkpoint/jungdam/Research/ScaDive/data/learning/multiagent/boxing/
checkpoint_freq: 100
checkpoint_at_end: true
stop: 
    time_total_s: 720000
config:
    env: HumanoidBoxing
    log_level: WARN
    gamma: 0.99
    lambda: 0.95
    clip_param: 0.2
    kl_coeff: 0.0
    vf_clip_param: 1000
    num_sgd_iter: 20
    lr: 0.00001
    sgd_minibatch_size: 2000
    horizon: 900
    train_batch_size: 150000
    rollout_fragment_length: 250
    framework: "torch"
    num_envs_per_worker: 10
    num_cpus_per_worker: 10
    num_gpus_per_worker: 0
    remote_worker_envs: true
    # shuffle_sequences: true
    model:
        custom_model: moe_additive
        custom_model_config:
            gate_fn_type: fc
            gate_fn_hiddens: [128, 128]
            # gate_fn_autoreg: true
            # gate_fn_autoreg_alpha: 0.9
            gate_fn_init_weights: [15.0, 15.0, 0.15]
            log_std_type: constant
            sample_std: 0.1
            expert_size_in: 267
            expert_size_out: 51
            expert_hiddens: [
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
            ]
            expert_activations: [
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
                ["relu", "relu", "linear"],
            ]
            expert_init_weights: [
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
            ]
            expert_log_std_types: [
                "none",
                "none",
                "none",
                "none",
                "none",
                "none",
                "none",
                "none",
                "none",
                "none",
                "none",
            ]
            expert_checkpoints: [
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert1_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert2_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert3_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert4_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert5_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert6_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert7_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert8_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert9_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert10_1800.pt",
                "data/etc/pretrained_model/boxing/policy_weights_boxing_expert11_1800.pt",
            ]
            expert_learnable: [
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
            ]
            use_helper: true
            helper_hiddens: [
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
                [64, 64],
            ]
            helper_activations: [
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
                ["tanh", "tanh", "tanh"],
            ]
            helper_init_weights: [
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
                [1.0, 1.0, 0.01],
            ]
            helper_checkpoints: [
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
                false,
            ]
            helper_learnable: [
                true,
                true,
                true,
                true,
                true,
                true,
                true,
                true,
                true,
                true,
                true,
            ]
    num_workers: 8
    num_gpus: 0
    batch_mode: truncate_episodes
    observation_filter: NoFilter
    multiagent: None
    env_config:
        ac_scale: 3.0
        dphase_default: 0.01
        share_policy: true
        lazy_creation: false
        project_dir: /private/home/jungdam/Research/ScaDive/
        fps_sim: 480
        fps_con: 30
        self_collision: true
        add_noise: false
        verbose: false
        state:
            choices: ['body', 'phase_linear', 'game_basic', 'game_touch_avail']
        action:
            # 'absolute', 'relative'
            type: "absolute"
            range_min: -3.0
            range_max: 3.0
            range_min_pol: -3.0
            range_max_pol: 3.0
        reward: 
            fn_def:
                default:
                    name: default
                    op: add
                    child_nodes:
                      - name: boxing
                        op: add
                        weight: 1.0
                        child_nodes:
                          - name: dist_to_targets
                            op: leaf
                            weight: 0.2
                            kernel: 
                                type: gaussian
                                scale: 3.0
                          - name: out_of_arena
                            op: leaf
                            weight: -10.0
                            kernel: 
                                type: none
                          - name: falldown
                            op: leaf
                            weight: -10.0
                            kernel: 
                                type: none
                          - name: too_close_pos
                            op: leaf
                            weight: -10.0
                            kernel: 
                                type: none
                          - name: take_score
                            op: leaf
                            weight: 1.0
                            kernel: 
                                type: none
                          - name: lose_score
                            op: leaf
                            weight: -1.0
                            kernel: 
                                type: none
            fn_map:
                - default
                - default
        early_term:
            # 'sim_div', 'sim_window', task_end', 'falldown', 'low_reward'
            choices:
                # - ref_motion_end
                - timeover
                - gameover
                - falldown
                # - out_of_arena
                # - too_close_pos
            eoe_margin: 0.1
        character:
            name:
                - player1
                - player2
            char_info_module:
                - humanoid_boxing_char_info.py
                - humanoid_boxing_char_info.py
            sim_char_file:
                - data/character/humanoid_boxing.urdf
                - data/character/humanoid_boxing.urdf
            ref_motion_scale:
                - 1.0
                - 1.0
            base_motion_file:
                - data/motion/multiagent/boxing/player1.bvh
                - data/motion/multiagent/boxing/player2.bvh
            ref_motion_db:
                - data:
                    file:
                        - data/motion/multiagent/boxing/player1.bvh
                    # dir:
                    #     - data/motion/multiagent/boxing/base/
                - data:
                    file:
                        - data/motion/multiagent/boxing/player2.bvh
                    # dir:
                    #     - data/motion/multiagent/boxing/base/
            actuation: 
                - spd
                - spd
            self_collision: 
                - true
                - true
            environment_file: []
        game:
            min_touch_force: 1.0
            type: total_score
            init_score: 9999.0
            duration: 30.0
            touch_interval: 0.5
            target_links:
                - lowerneck
                - upperneck
                - lowerback
                - upperback
                - chest
                - lclavicle
                - rclavicle
                # - lhip
                # - lknee
                # - lankle
                # - rhip
                # - rknee
                # - rankle