run: DDPPO
name: debug25
local_dir: /checkpoint/jungdam/Research/ScaDive/data/learning/pfnn/tag/
checkpoint_freq: 100
checkpoint_at_end: true
reuse_actors: true
stop: 
    time_total_s: 720000
config:
    env: HumanoidTag
    log_level: WARN
    gamma: 0.995
    lambda: 0.95
    clip_param: 0.2
    kl_coeff: 0.0
    vf_clip_param: 1000
    num_sgd_iter: 20
    lr: 0.00002
    sgd_minibatch_size: 100
    horizon: 3600
    train_batch_size: 10000
    rollout_fragment_length: 50
    normalize_actions: false
    clip_actions: true
    num_envs_per_worker: 5
    num_cpus_per_worker: 5
    num_gpus_per_worker: 0
    remote_worker_envs: true
    framework: torch
    model:
        post_fcnet_hiddens: [256, 256]
        use_lstm: true
        vf_share_layers: false
        # custom_model: task_agnostic_policy_type1
        # custom_model_config:
        #     log_std_type: constant
        #     sample_std: 0.1
        #     task_encoder_type: "lstm"
        #     task_encoder_inputs:
        #         - body
        #         - task
        #     task_encoder_output_dim: 32
        #     task_encoder_layers:
        #         - type: lstm
        #           hidden_size: 256
        #           num_layers: 2
        #           output_activation: "linear"
            
        #     body_encoder_enable: false

        #     motor_decoder_type: "mlp"
        #     motor_decoder_inputs:
        #         - body
        #         - task
        #     motor_decoder_layers:
        #         - type: fc
        #           hidden_size: 512
        #           activation: "relu"
        #           init_weight: 
        #               name: normc
        #               std: 1.0
        #         - type: fc
        #           hidden_size: 512
        #           activation: "relu"
        #           init_weight: 
        #               name: normc
        #               std: 1.0
        #         - type: fc
        #           hidden_size: 512
        #           activation: "relu"
        #           init_weight: 
        #               name: normc
        #               std: 1.0
        #         - type: fc
        #           hidden_size: output
        #           activation: "linear"
        #           init_weight: 
        #               name: normc
        #               std: 0.01
        #     motor_decoder_load_weights: data/etc/pretrained_model/pfnn/TrainModel_2021-10-15_01-43-01/9/task_agnostic_policy_motor_decoder.pt
        #     motor_decoder_learnable: false

        #     motor_decoder_helper_enable: true
        #     motor_decoder_helper_range: 0.5
    num_workers: 8
    num_gpus: 0
    batch_mode: truncate_episodes
    observation_filter: NoFilter
    env_config:
        share_policy: false
        lazy_creation: false
        project_dir: /private/home/jungdam/Research/ScaDive/
        fps_sim: 480
        fps_con: 30
        add_noise: false
        verbose: false
        ground:
            enable: true
            friction_coeff: 2.0
            contact_stiffness: 50000
            contact_damping: 1000
            height_measure_offset: 4.0
            size: 
                - 15.0 # width1
                - 15.0 # width2
                - 5.0 # height
        state:
            choices: ['body', 'vision', 'opponent_com_pos_vel_always']
            body_type: facing_R6_h
        action:
            # 'absolute', 'relative'
            type: "absolute"
            range_min: -3.0
            range_max: 3.0
            range_min_pol: -3.0
            range_max_pol: 3.0
        reward: 
            fn_def:
                player1:
                    name: total
                    op: add
                    child_nodes:
                      - name: alive
                        op: leaf
                        weight: 0.05
                        kernel: 
                            type: none
                      - name: falldown
                        op: leaf
                        weight: -1.0
                        kernel: 
                            type: none
                      - name: hit_the_wall
                        op: leaf
                        weight: -0.1
                        kernel: 
                            type: none
                      - name: dist_always
                        op: leaf
                        weight: 0.1
                        kernel: 
                            type: gaussian
                            scale: 0.1
                player2:
                    name: total
                    op: add
                    child_nodes:
                      - name: alive
                        op: leaf
                        weight: 0.05
                        kernel: 
                            type: none
                      - name: falldown
                        op: leaf
                        weight: -1.0
                        kernel: 
                            type: none
                      - name: hit_the_wall
                        op: leaf
                        weight: -0.1
                        kernel: 
                            type: none
                      - name: dist_always
                        op: leaf
                        weight: -0.1
                        kernel: 
                            type: gaussian
                            scale: 0.1
            fn_map:
                - player1
                - player2
        early_term:
            choices:
                - falldown
                - out_of_ground
                - gameover
            eoe_margin: 0.0
        character:
            name:
                - player1
                - player2
            char_info_module:
                - pfnn_char_info.py
                - pfnn_char_info.py
            sim_char_file:
                - data/character/pfnn.urdf
                - data/character/pfnn.urdf
            ref_motion_scale:
                - 1.0
                - 1.0
            base_motion_file:
                - data/motion/pfnn/pfnn_hierarchy.bvh
                - data/motion/pfnn/pfnn_hierarchy.bvh
            ref_motion_db:
                -
                    data:
                        file:
                            - data/motion/pfnn/pfnn_follower_init_states_tag1.bvh
                -
                    data:
                        file:
                            - data/motion/pfnn/pfnn_follower_init_states_tag1.bvh
            actuation: 
                - spd
                - spd
            self_collision: 
                - true
                - true
            environment_file:
                - data/ground/tag3.urdf
            sensors:
                - 
                    vision_forward:
                        type: vision
                        num_history: 2
                        agent_radius: 0.4
                        num_ray: 64
                        max_dist_ray: 15
                        angle_ray: 30
                        angle_ray_offset: 0
                        height_offset: 0.5
                        attachment: none
                - 
                    vision_forward:
                        type: vision
                        num_history: 2
                        agent_radius: 0.4
                        num_ray: 64
                        max_dist_ray: 4
                        angle_ray: 240
                        angle_ray_offset: 0
                        height_offset: 0.5
                        attachment: none
            launching_places:
                -
                    -
                        type: box
                        p_min: [-6.0, -6.0]
                        p_max: [-6.0, 6.0]
                        rotation: [-3.14, 3.14]
                    -
                        type: box
                        p_min: [-3.0, -6.0]
                        p_max: [-3.0, 6.0]
                        rotation: [-3.14, 3.14]
                    -
                        type: box
                        p_min: [0.0, -6.0]
                        p_max: [0.0, -1.0]
                        rotation: [-3.14, 3.14]
                -
                    -
                        type: box
                        p_min: [6.0, -6.0]
                        p_max: [6.0, 6.0]
                        rotation: [-3.14, 3.14]
                    -
                        type: box
                        p_min: [3.0, -6.0]
                        p_max: [3.0, 6.0]
                        rotation: [-3.14, 3.14]
                    -
                        type: box
                        p_min: [0.0, 1.0]
                        p_max: [0.0, 6.0]
                        rotation: [-3.14, 3.14]