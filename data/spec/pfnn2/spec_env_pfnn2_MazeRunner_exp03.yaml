run: DDPPO
name: exp03
local_dir: /checkpoint/jungdam/Research/ScaDive/data/learning/pfnn2/MazeRunner/
checkpoint_freq: 500
checkpoint_at_end: true
reuse_actors: true
stop: 
    time_total_s: 720000
config:
    env: HumanoidFollower
    log_level: WARN
    gamma: 0.99
    lambda: 0.95
    clip_param: 0.2
    kl_coeff: 0.0
    vf_clip_param: 10000
    num_sgd_iter: 20
    lr: 0.00002
    sgd_minibatch_size: 500
    horizon: 3600
    train_batch_size: 50000
    rollout_fragment_length: 25
    normalize_actions: false
    clip_actions: true
    num_envs_per_worker: 5
    num_cpus_per_worker: 5
    num_gpus_per_worker: 0
    remote_worker_envs: true
    framework: torch
    shuffle_sequences: false
    model:
        custom_model: task_agnostic_policy_type1
        custom_model_config:
            log_std_type: constant
            sample_std: 0.05
            task_encoder_type: "mlp"
            task_encoder_inputs:
                # - body
                - task
            task_encoder_output_dim: 32
            task_encoder_layers:
                - type: fc
                  hidden_size: 256
                  activation: "relu"
                  init_weight: 
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: 128
                  activation: "relu"
                  init_weight: 
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: output
                  activation: "linear"
                  init_weight: 
                      name: normc
                      std: 0.01
            
            body_encoder_enable: false

            motor_decoder_type: "mlp"
            motor_decoder_inputs:
                - body
                - task
            motor_decoder_layers:
                - type: fc
                  hidden_size: 512
                  activation: "relu"
                  init_weight: 
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: 512
                  activation: "relu"
                  init_weight: 
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: 512
                  activation: "relu"
                  init_weight: 
                      name: normc
                      std: 1.0
                - type: fc
                  hidden_size: output
                  activation: "linear"
                  init_weight: 
                      name: normc
                      std: 0.01
            motor_decoder_load_weights: data/etc/pretrained_model/pfnn2/TrainModel_2022-01-07_14-57-30/TrainModel_31335_00009_9_FP_cyc_coeff=0.003,FP_depth=2,FP_width=1024,MD_depth=3,MD_type=mlp,MD_width=512,TE_cond=abs,a_rec_coeff=1_2022-01-07_14-59-27/checkpoint_000600/motor_decoder.pt
            motor_decoder_learnable: false

            motor_decoder_helper_enable: true
            motor_decoder_helper_range: 0.1

            # value_fn_type: "lstm"
            # value_fn_layers:
            #     - type: lstm
            #       hidden_size: 256
            #       num_layers: 1
            #       output_layers:
            #         - type: fc
            #           hidden_size: 128
            #           activation: "relu"
            #           init_weight: 
            #               name: normc
            #               std: 1.0
            #         - type: fc
            #           hidden_size: 128
            #           activation: "relu"
            #           init_weight: 
            #               name: normc
            #               std: 1.0
            #         - type: fc
            #           hidden_size: output
            #           activation: "linear"
            #           init_weight: 
            #               name: normc
            #               std: 0.01
    num_workers: 8
    num_gpus: 0
    batch_mode: truncate_episodes
    observation_filter: NoFilter
    env_config:
        lazy_creation: false
        project_dir: /private/home/jungdam/Research/ScaDive/
        fps_sim: 480
        fps_con: 30
        add_noise: false
        verbose: false
        ground:
            enable: true
            falldown_check:
                method: height
                height_min: 0.3
            size: 
                - 24.0 # width1
                - 24.0 # width2
                - 5.0 # heigh, only used for checking out-of-ground
        state:
            choices: ['body', 'vision', 'goal']
            body_type: facing_R6_h
        action:
            # 'absolute', 'relative'
            type: "absolute"
            range_min: -3.0
            range_max: 3.0
            range_min_pol: -3.0
            range_max_pol: 3.0
        reward: 
            fn_def:
                default:
                    name: total
                    op: add
                    child_nodes:
                      - name: cover
                        op: leaf
                        weight: 1.0
                        kernel: 
                            type: none
                      # - name: falldown
                      #   op: leaf
                      #   weight: -1.0
                      #   kernel: 
                      #       type: none
                      # - name: hit_the_wall
                      #   op: leaf
                      #   weight: -0.1
                      #   kernel: 
                      #       type: none
                      - name: task_complete
                        op: leaf
                        weight: 10.0
                        kernel: 
                            type: none
            fn_map:
                - default
        early_term:
            choices:
                - falldown
                - out_of_ground
                - task_complete
            eoe_margin: 0.1
        character:
            name:
                - agent1
            char_info_module:
                - pfnn_char_info2.py
            sim_char_file:
                - data/character/pfnn2.urdf
            ref_motion_scale:
                - 1.0
            ref_motion_height_fix:
                - -0.1
            base_motion_file:
                - data/motion/pfnn/pfnn_hierarchy.bvh
            ref_motion_db:
                -
                    data:
                        file:
                            - data/motion/pfnn/pfnn_follower_init_states_maze.bvh
            physics:
                -
                    actuation: spd
                    self_collision: true
            environment_file:
                - data/character/maze.urdf
            sensors:
                - 
                    vision_forward:
                        type: vision
                        num_history: 2
                        agent_radius: 0.1
                        num_ray: 16
                        max_dist_ray: 10
                        angle_ray: 120
                        angle_ray_offset: 0
                        height_offset: 1.4
                        attachment: none
                    vision_backward:
                        type: vision
                        num_history: 2
                        agent_radius: 0.1
                        num_ray: 32
                        max_dist_ray: 3
                        angle_ray: 240
                        angle_ray_offset: 180
                        height_offset: 1.4
                        attachment: none
            launching_places:
                -
                    # -
                    #     type: circle
                    #     p_center: [11.0, 11.0]
                    #     radius_min: 0.0
                    #     radius_max: 0.05
                    #     rotation: [-3.14, 3.14]
                    -
                        type: circle
                        p_center: [11.0, -11.0]
                        radius_min: 0.0
                        radius_max: 0.05
                        rotation: [0, 0]
                    # -
                    #     type: circle
                    #     p_center: [-11.0, 11.0]
                    #     radius_min: 0.0
                    #     radius_max: 0.05
                    #     rotation: [-3.14, 3.14]
                    # -
                    #     type: circle
                    #     p_center: [-11.0, -11.0]
                    #     radius_min: 0.0
                    #     radius_max: 0.05
                    #     rotation: [-3.14, 3.14]
                    # -
                    #     type: circle
                    #     p_center: [-1.0, 0.0]
                    #     radius_min: 0.0
                    #     radius_max: 0.05
                    #     rotation: [-3.14, 3.14]
        goal:
            type: maze
            map_size: [24, 24]
            num_buckets: [8, 8]
            coverage_ratio_for_completion: 1.0